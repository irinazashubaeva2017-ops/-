<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TEQRA DUO</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:linear-gradient(145deg,#0f172a,#111827);
color:white;
}

.wrapper{
max-width:480px;
margin:auto;
padding:20px;
}

.title{
text-align:center;
letter-spacing:3px;
opacity:.5;
margin-bottom:10px;
}

.balance{
text-align:center;
font-size:42px;
font-weight:700;
margin-bottom:20px;
}

.card{
background:#1e293b;
padding:15px;
border-radius:16px;
margin-bottom:12px;
}

.row{
display:flex;
justify-content:space-between;
margin:6px 0;
font-size:14px;
}

input{
width:100%;
padding:14px;
margin-bottom:10px;
border-radius:14px;
border:none;
background:#111827;
color:white;
font-size:16px;
}

button{
width:100%;
padding:14px;
border:none;
border-radius:16px;
background:#3b82f6;
color:white;
font-weight:600;
margin-bottom:15px;
}

.listItem{
display:flex;
justify-content:space-between;
padding:8px 0;
border-bottom:1px solid rgba(255,255,255,0.05);
font-size:13px;
}

.green{color:#22c55e;}
.red{color:#ef4444;}

.analysis{
background:#111827;
padding:12px;
border-radius:16px;
font-size:13px;
line-height:1.5;
}
</style>
</head>

<body onclick="hideKeyboard(event)">
<div class="wrapper">

<div class="title">TEQRA ‚Ä¢ DUO</div>

<div class="balance" id="balance">0 –≥—Ä–Ω</div>

<div class="card" id="stats"></div>

<input id="amount" type="number" inputmode="numeric" placeholder="–°—É–º–∞">
<input id="category" type="text" placeholder="–ö–∞—Ç–µ–≥–æ—Ä—ñ—è">

<select id="type" style="width:100%;padding:12px;border-radius:12px;background:#111827;color:white;margin-bottom:10px;">
<option value="income">–î–æ—Ö—ñ–¥</option>
<option value="expense">–í–∏—Ç—Ä–∞—Ç–∞</option>
</select>

<select id="person" style="width:100%;padding:12px;border-radius:12px;background:#111827;color:white;margin-bottom:10px;">
<option value="ira">–Ü—Ä–∞</option>
<option value="misha">–ú—ñ—à–∞</option>
</select>

<button onclick="addTransaction()">–î–æ–¥–∞—Ç–∏</button>

<div id="transactions"></div>

<div class="analysis" id="analysis"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyBSCke0wwX9GbZRiw1xG97v7KWRUERQsc",
authDomain:"finance-eec75.firebaseapp.com",
projectId:"finance-eec75"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const allowed=["7255848995","921509542"];
const uid = Telegram.WebApp.initDataUnsafe.user?.id?.toString();

if(!allowed.includes(uid)){
document.body.innerHTML="<h2 style='text-align:center;margin-top:40%'>–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ</h2>";
}

window.hideKeyboard=function(e){
const active=document.activeElement;
if(active&&active.tagName==="INPUT"&&e.target.tagName!=="INPUT"){
active.blur();
}
}

window.addTransaction=async function(){
const amount=parseFloat(document.getElementById("amount").value);
const category=document.getElementById("category").value;
const type=document.getElementById("type").value;
const person=document.getElementById("person").value;

if(!amount||!category)return;

await addDoc(collection(db,"transactions"),{
amount,type,category,person,date:new Date()
});

document.getElementById("amount").value="";
document.getElementById("category").value="";
}

onSnapshot(collection(db,"transactions"),snap=>{

let totalIncome=0,totalExpense=0;
let ira={income:0,expense:0};
let misha={income:0,expense:0};
let expenseCategories={},incomeCategories={};
let html="";

snap.forEach(doc=>{
const d=doc.data();
const sign=d.type==="income"?"+":"-";
const color=d.type==="income"?"green":"red";

if(d.type==="income"){
totalIncome+=d.amount;
incomeCategories[d.category]=(incomeCategories[d.category]||0)+d.amount;
}else{
totalExpense+=d.amount;
expenseCategories[d.category]=(expenseCategories[d.category]||0)+d.amount;
}

if(d.person==="ira"){
if(d.type==="income")ira.income+=d.amount;
else ira.expense+=d.amount;
}else{
if(d.type==="income")misha.income+=d.amount;
else misha.expense+=d.amount;
}

html+=`
<div class="listItem">
<span>${d.category} (${d.person})</span>
<span class="${color}">${sign}${d.amount}</span>
</div>`;
});

document.getElementById("transactions").innerHTML=html;
document.getElementById("balance").innerText=(totalIncome-totalExpense)+" –≥—Ä–Ω";

document.getElementById("stats").innerHTML=`
<div class="row"><div>–Ü—Ä–∞:</div><div>+${ira.income} / -${ira.expense}</div></div>
<div class="row"><div>–ú—ñ—à–∞:</div><div>+${misha.income} / -${misha.expense}</div></div>
<div class="row"><div>–ó–∞–≥–∞–ª—å–Ω–∏–π –¥–æ—Ö—ñ–¥:</div><div>${totalIncome}</div></div>
<div class="row"><div>–ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏:</div><div>${totalExpense}</div></div>
`;

let biggestExpense="",maxExp=0;
for(let cat in expenseCategories){
if(expenseCategories[cat]>maxExp){
maxExp=expenseCategories[cat];
biggestExpense=cat;
}
}

let biggestIncome="",maxInc=0;
for(let cat in incomeCategories){
if(incomeCategories[cat]>maxInc){
maxInc=incomeCategories[cat];
biggestIncome=cat;
}
}

let expPercent=totalExpense?((maxExp/totalExpense)*100).toFixed(1):0;
let incPercent=totalIncome?((maxInc/totalIncome)*100).toFixed(1):0;

document.getElementById("analysis").innerHTML=`
üî• –ù–∞–π–±—ñ–ª—å—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏: ${biggestExpense||"-"} (${expPercent}% –≤—ñ–¥ –≤–∏—Ç—Ä–∞—Ç)<br>
üí∞ –û—Å–Ω–æ–≤–Ω–∏–π –¥–æ—Ö—ñ–¥: ${biggestIncome||"-"} (${incPercent}% –≤—ñ–¥ –¥–æ—Ö–æ–¥—ñ–≤)<br><br>
üí° –Ø–∫—â–æ –≤–∏—Ç—Ä–∞—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –ø–µ—Ä–µ–≤–∏—â—É—é—Ç—å 40% ‚Äî –≤–∞—Ä—Ç–æ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –±—é–¥–∂–µ—Ç.<br>
üöÄ –Ø–∫—â–æ –¥–æ—Ö—ñ–¥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ä–æ—Å—Ç–µ ‚Äî —Ü–µ —Ç–æ—á–∫–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è.
`;

});

</script>
</body>
</html>
