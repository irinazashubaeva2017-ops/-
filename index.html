<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TEQRA Finance Cloud</title>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:#0f1117;
color:white;
touch-action:manipulation;
}

.app{
max-width:420px;
margin:auto;
padding:25px;
}

.balance{
text-align:center;
font-size:42px;
margin-bottom:20px;
font-weight:600;
transition:0.3s;
}

.positive{color:#22c55e}
.negative{color:#ef4444}

.switch{
display:flex;
gap:10px;
margin-bottom:12px;
}

.switch button{
flex:1;
padding:12px;
border-radius:16px;
border:1px solid #2a2f38;
background:#1a1f27;
color:#aaa;
font-weight:500;
}

.active{
background:#2563eb !important;
color:white !important;
border-color:#2563eb !important;
}

input{
width:100%;
padding:14px;
border-radius:16px;
border:1px solid #2a2f38;
background:#1a1f27;
color:white;
margin-bottom:12px;
font-size:14px;
outline:none;
}

button.main{
width:100%;
padding:14px;
border-radius:20px;
border:none;
background:#2563eb;
color:white;
font-weight:600;
margin-bottom:20px;
}

.item{
display:flex;
justify-content:space-between;
padding:12px 0;
border-bottom:1px solid #1f242c;
font-size:14px;
}

.income{color:#22c55e}
.expense{color:#ef4444}
</style>
</head>

<body>

<div class="app">

<div class="balance positive" id="total">0 грн</div>

<div class="switch">
<button id="iraBtn" class="active" onclick="setUser('Іра')">Іра</button>
<button id="mishaBtn" onclick="setUser('Міша')">Міша</button>
</div>

<div class="switch">
<button id="incomeBtn" class="active" onclick="setType('income')">Дохід</button>
<button id="expenseBtn" onclick="setType('expense')">Витрата</button>
</div>

<input type="number" id="amount" placeholder="Сума" inputmode="decimal">
<input type="text" id="category" placeholder="Категорія">

<button class="main" onclick="addOperation()">Додати</button>

<div id="list"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBSCke0wwX9GbZRiw1xG97v7KWRUERQsc",
  authDomain: "finance-eec75.firebaseapp.com",
  projectId: "finance-eec75",
  storageBucket: "finance-eec75.appspot.com",
  messagingSenderId: "386010317837",
  appId: "1:386010317837:web:88a24adc90b403e42a4144"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const operationsRef = collection(db, "operations");

let currentUser = "Іра";
let currentType = "income";

window.setUser = function(user){
  currentUser = user;
  document.getElementById("iraBtn").classList.toggle("active", user==="Іра");
  document.getElementById("mishaBtn").classList.toggle("active", user==="Міша");
}

window.setType = function(type){
  currentType = type;
  document.getElementById("incomeBtn").classList.toggle("active", type==="income");
  document.getElementById("expenseBtn").classList.toggle("active", type==="expense");
}

window.addOperation = async function(){
  const amount = parseFloat(document.getElementById("amount").value);
  const category = document.getElementById("category").value;

  if(!amount || !category) return;

  await addDoc(operationsRef,{
    amount,
    category,
    type: currentType,
    author: currentUser,
    createdAt: new Date()
  });

  document.getElementById("amount").value="";
  document.getElementById("category").value="";
}

function render(snapshot){
  const list = document.getElementById("list");
  list.innerHTML="";
  let total=0;

  snapshot.forEach(docSnap=>{
    const item = docSnap.data();
    total += item.type==="income" ? item.amount : -item.amount;

    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`
      <div>${item.category} (${item.author})</div>
      <div class="${item.type}">
        ${item.type==="income"?"+":"-"} ${item.amount}
      </div>
    `;
    list.appendChild(div);
  });

  const totalEl=document.getElementById("total");
  totalEl.innerText=total+" грн";
  totalEl.className="balance "+(total>=0?"positive":"negative");
}

onSnapshot(query(operationsRef, orderBy("createdAt","desc")), render);

</script>

</body>
</html>
